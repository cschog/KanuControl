databaseChangeLog:
  - changeSet:
      id: create-teilnehmer-table
      author: chris
      changes:

        - createTable:
            tableName: teilnehmer
            columns:

              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false

              # =========================
              # Beziehungen
              # =========================

              - column:
                  name: veranstaltung_id
                  type: BIGINT
                  constraints:
                    nullable: false

              - column:
                  name: person_id
                  type: BIGINT
                  constraints:
                    nullable: false

              # =========================
              # Rolle
              # =========================

              - column:
                  name: rolle
                  type: char(1)
                  constraints:
                    nullable: false

              # =========================
              # Status
              # =========================

              - column:
                  name: aktiv
                  type: BOOLEAN
                  constraints:
                    nullable: false

              # =========================
              # Auditable
              # =========================

              - column:
                  name: created_at
                  type: TIMESTAMP

              - column:
                  name: created_by
                  type: VARCHAR(100)

              - column:
                  name: last_modified_at
                  type: TIMESTAMP

              - column:
                  name: last_modified_by
                  type: VARCHAR(100)

        # =========================
        # Foreign Keys
        # =========================

        - addForeignKeyConstraint:
            baseTableName: teilnehmer
            baseColumnNames: veranstaltung_id
            referencedTableName: veranstaltung
            referencedColumnNames: id
            constraintName: fk_teilnehmer_veranstaltung
            onDelete: CASCADE

        - addForeignKeyConstraint:
            baseTableName: teilnehmer
            baseColumnNames: person_id
            referencedTableName: person
            referencedColumnNames: id
            constraintName: fk_teilnehmer_person
            onDelete: RESTRICT

        # =========================
        # Unique Constraint
        # =========================

        - addUniqueConstraint:
            tableName: teilnehmer
            columnNames: veranstaltung_id, person_id
            constraintName: uk_teilnehmer_veranstaltung_person

        # =========================
        # Indexe
        # =========================

        - createIndex:
            tableName: teilnehmer
            indexName: idx_teilnehmer_veranstaltung
            columns:
              - column:
                  name: veranstaltung_id

        - createIndex:
            tableName: teilnehmer
            indexName: idx_teilnehmer_person
            columns:
              - column:
                  name: person_id

        - createIndex:
            tableName: teilnehmer
            indexName: idx_teilnehmer_rolle
            columns:
              - column:
                  name: rolle